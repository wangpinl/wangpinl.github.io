<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">Tengine | 微笑的个人主页</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "微笑の个人主页";
  mashiro_option.author_name = "个人主页";
  mashiro_option.site_url = "https://secondes.github.io/";
  mashiro_option.v_appId = "QXrHWOweL6iiH8ULUmPjBVhb-gzGzoHsz";
  mashiro_option.v_appKey = "3es5KSduLLezurh1rn90e0vu";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://www.yremp.live/images/2020/04/22/79344899_p091551.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;},.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit" style="background-image: url(https://www.yremp.live/images/2020/03/18/77865316_p07c784.jpg);">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <img src="https://q2.qlogo.cn/headimg_dl?dst_uin=46029882&spec=640">
      </div>
      <div class="header-info">
        <p>The degree of loving is measured by the degree of giving</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/Secondes" target="_blank" class="social-github" title="github">
                    <img src="https://www.yremp.live/images/2019/09/03/github2cfca.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://twitter.com/1t5RE1tdGpmcW4Z" target="_blank" class="social-github" title="twitter">
                    <img src="https://www.yremp.live/images/2019/09/03/twitter68cc0.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://www.facebook.com/profile.php?id=100035330672131" target="_blank" class="social-github" title="facebook">
                    <img src="https://www.yremp.live/images/2019/09/03/facebook73baf.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://moxiaowu495@gmail.com" target="_blank" class="social-github" title="gmail">
                    <img src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=46029882&amp;website=www.oicqzone.com" target="_blank" class="social-github" title="qq">
                    <img src="https://www.yremp.live/images/2019/09/03/qqdfdb4.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://www.yremp.live/images/2019/09/03/wechat28a70.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="display:none">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name src width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">微笑の</span>
            <span class="shironeko">个人主页</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/生活/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/资源/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          资源
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://www.yremp.live/images/2019/08/25/QQ201908251817541a359.jpg);" src="https://cdn.jsdelivr.net/gh/Secondes/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://www.yremp.live/images/2019/08/25/QQ201908251817541a359.jpg">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      Tengine</h1>
      <p class="entry-census">
        <span>
          <a href="www.secondaries.cn">
            <img src="https://q2.qlogo.cn/headimg_dl?dst_uin=46029882&spec=100">
          </a>
        </span>
        <span>
          <a href="www.secondaries.cn">微笑</a>
        </span>
        <span class="bull">
        ·</span>
        2019-8-25<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="Tengine"><a href="#Tengine" class="headerlink" title="Tengine"></a>Tengine</h1><h2 id="Nginx和Tengine"><a href="#Nginx和Tengine" class="headerlink" title="Nginx和Tengine"></a>Nginx和Tengine</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>Nginx (“engine x”) 是一个高性能的 <strong>HTTP</strong> 和 <strong>反向代理</strong> 服务器，也是一个 IMAP/POP3/SMTP 代理服务器。</p>
<p>•第一个公开版本0.1.0发布于2004年10月4日。</p>
<p>其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名</p>
<p>官方测试nginx能够支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定</p>
<p>2011年6月1日，nginx 1.0.4发布。</p>
<p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。由俄罗斯的程序设计师Igor Sysoev所开发，</p>
<p>其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：新浪、网易、腾讯等。</p>
<p><img src="https://www.yremp.live/images/2019/08/25/156291836188872c81.png" alt="156291836188872c81.png"></p>
<p>功能：</p>
<ul>
<li><p>web服务器</p>
</li>
<li><p>web reverse proxy</p>
</li>
<li><p>smtp reverse proxy</p>
</li>
</ul>
<h3 id="Nginx和apache的优缺点"><a href="#Nginx和apache的优缺点" class="headerlink" title="Nginx和apache的优缺点"></a>Nginx和apache的优缺点</h3><h4 id="nginx相对于apache的优点："><a href="#nginx相对于apache的优点：" class="headerlink" title="nginx相对于apache的优点："></a>nginx相对于apache的优点：</h4><ul>
<li>轻量级，同样起web 服务，比apache 占用更少的内存及资源 </li>
<li>抗并发，nginx 处理请求是异步非阻塞的，而apache 则是阻塞型的，在高并发下nginx 能保持低资源低消耗高性能 </li>
<li>高度模块化的设计，编写模块相对简单</li>
<li>社区活跃，各种高性能模块出品迅速</li>
</ul>
<h4 id="apache-相对于nginx-的优点："><a href="#apache-相对于nginx-的优点：" class="headerlink" title="apache 相对于nginx 的优点："></a>apache 相对于nginx 的优点：</h4><ul>
<li>rewrite ，比nginx 的rewrite 强大</li>
<li>模块超多，基本想到的都可以找到</li>
<li>少bug ，nginx 的bug 相对较多 </li>
</ul>
<p>Nginx 配置简洁, Apache 复杂 </p>
<p>最核心的区别在于apache是同步多进程模型，一个连接对应一个进程；</p>
<p>nginx是异步的，多个连接（万级别）可以对应一个进程</p>
<h2 id="Nginx解决的问题"><a href="#Nginx解决的问题" class="headerlink" title="Nginx解决的问题"></a>Nginx解决的问题</h2><ul>
<li>高并发</li>
<li>负载均衡</li>
<li>高可用</li>
<li>虚拟主机</li>
<li>伪静态</li>
<li>动静分离</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><p>最好使用linux操作系统，课上使用VirtualBox或VMware虚拟机搭建centos6.x做实验。</p>
<p>系统依赖组件 <code>gcc openssl-devel pcre-devel zlib-devel</code></p>
<p>安装：<code>yum install gcc openssl-devel pcre-devel zlib-devel</code></p>
<h4 id="Tengine下载和文档"><a href="#Tengine下载和文档" class="headerlink" title="Tengine下载和文档"></a>Tengine下载和文档</h4><p><a href="http://tengine.taobao.org/" target="_blank" rel="noopener">http://tengine.taobao.org/</a></p>
<h4 id="Nginx官网和文档"><a href="#Nginx官网和文档" class="headerlink" title="Nginx官网和文档"></a>Nginx官网和文档</h4><p><a href="http://nginx.org" target="_blank" rel="noopener">http://nginx.org</a></p>
<p>上传Nginx压缩包到服务器，一般安装在/usr/local目录下</p>
<h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><pre><code class="shell">./ configure --prefix=/安装路径
make &amp;&amp; make install
</code></pre>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><h3 id="脚本自启动"><a href="#脚本自启动" class="headerlink" title="脚本自启动"></a>脚本自启动</h3><p>拷贝附件提供的Nginx启动脚本文件内容到<code>/etc/init.d/nginx</code>这个文件中</p>
<p>目录下如果没有这个文件的话需要手动创建</p>
<h4 id="修改可执行权限"><a href="#修改可执行权限" class="headerlink" title="修改可执行权限"></a>修改可执行权限</h4><p>chmod 777 nginx</p>
<h4 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h4><p>service Nginx start  启动服务</p>
<p>service Nginx stop 停止</p>
<p>service Nginx status 状态</p>
<p>service Nginx reload 动态重载配置文件</p>
<h4 id="脚本内容："><a href="#脚本内容：" class="headerlink" title="脚本内容："></a>脚本内容：</h4><pre><code class="shell">#!/bin/sh
#
# nginx - this script starts and stops the nginx daemon
#
# chkconfig:   - 85 15 
# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \
#               proxy and IMAP/POP3 proxy server
# processname: nginx
# config:      /etc/nginx/nginx.conf
# config:      /etc/sysconfig/nginx
# pidfile:     /var/run/nginx.pid

# Source function library.
. /etc/rc.d/init.d/functions

# Source networking configuration.
. /etc/sysconfig/network

# Check that networking is up.
[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0

nginx=&quot;/usr/local/sbin/nginx&quot;
prog=$(basename $nginx)

NGINX_CONF_FILE=&quot;/usr/local/conf/nginx.conf&quot;

[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx

lockfile=/var/lock/subsys/nginx

make_dirs() {
   # make required directories
   user=`nginx -V 2&gt;&amp;1 | grep &quot;configure arguments:&quot; | sed &#39;s/[^*]*--user=\([^ ]*\).*/\1/g&#39; -`
   options=`$nginx -V 2&gt;&amp;1 | grep &#39;configure arguments:&#39;`
   for opt in $options; do
       if [ `echo $opt | grep &#39;.*-temp-path&#39;` ]; then
           value=`echo $opt | cut -d &quot;=&quot; -f 2`
           if [ ! -d &quot;$value&quot; ]; then
               # echo &quot;creating&quot; $value
               mkdir -p $value &amp;&amp; chown -R $user $value
           fi
       fi
   done
}

start() {
    [ -x $nginx ] || exit 5
    [ -f $NGINX_CONF_FILE ] || exit 6
    make_dirs
    echo -n $&quot;Starting $prog: &quot;
    daemon $nginx -c $NGINX_CONF_FILE
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; touch $lockfile
    return $retval
}

stop() {
    echo -n $&quot;Stopping $prog: &quot;
    killproc $prog -QUIT
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}

restart() {
    configtest || return $?
    stop
    sleep 1
    start
}

reload() {
    configtest || return $?
    echo -n $&quot;Reloading $prog: &quot;
    killproc $nginx -HUP
    RETVAL=$?
    echo
}

force_reload() {
    restart
}

configtest() {
  $nginx -t -c $NGINX_CONF_FILE
}

rh_status() {
    status $prog
}

rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

case &quot;$1&quot; in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
        ;;
    reload)
        rh_status_q || exit 7
        $1
        ;;
    force-reload)
        force_reload
        ;;
    status)
        rh_status
        ;;
    condrestart|try-restart)
        rh_status_q || exit 0
            ;;
    *)
        echo $&quot;Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}&quot;
        exit 2
esac
</code></pre>
<h2 id="Nginx配置解析"><a href="#Nginx配置解析" class="headerlink" title="Nginx配置解析"></a>Nginx配置解析</h2><h3 id="定义Nginx运行的用户和用户组"><a href="#定义Nginx运行的用户和用户组" class="headerlink" title="定义Nginx运行的用户和用户组"></a>定义Nginx运行的用户和用户组</h3><p><code>user www www;</code></p>
<h3 id="进程数"><a href="#进程数" class="headerlink" title="进程数"></a>进程数</h3><p>建议设置为等于CPU总核心数。</p>
<p><code>worker_processes 8;</code></p>
<h3 id="全局错误日志"><a href="#全局错误日志" class="headerlink" title="全局错误日志"></a>全局错误日志</h3><p>全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</p>
<p><code>error_log /var/log/nginx/error.log info;</code></p>
<h3 id="进程文件"><a href="#进程文件" class="headerlink" title="进程文件"></a>进程文件</h3><p><code>pid /var/run/nginx.pid;</code></p>
<h3 id="打开的最多文件描述符"><a href="#打开的最多文件描述符" class="headerlink" title="打开的最多文件描述符"></a>打开的最多文件描述符</h3><p>一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</p>
<p><code>worker_rlimit_nofile 65535;</code></p>
<h3 id="event"><a href="#event" class="headerlink" title="event"></a>event</h3><h4 id="单个进程最大连接数"><a href="#单个进程最大连接数" class="headerlink" title="单个进程最大连接数"></a>单个进程最大连接数</h4><p>并发总数是 worker_processes 和 worker_connections 的乘积</p>
<p>即 max_clients = worker_processes * worker_connections</p>
<p>在设置了反向代理的情况下，max_clients = worker_processes <em> worker_connections / 4  为什么<br>为什么上面反向代理要除以4，应该说是一个经验值根据以上条件，正常情况下的Nginx Server可以应付的最大连接数为：4 </em> 8000 = 32000worker_connections 值的设置跟物理内存大小有关</p>
<p>因为并发受IO约束，max_clients的值须小于系统可以打开的最大文件数</p>
<pre><code>工作模式与连接数上限
events
{
    参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。
    use epoll;
    单个进程最大连接数（最大连接数=连接数*进程数）
    worker_connections 65535;
}
</code></pre><p><strong>可以打开的文件句柄数是多少</strong></p>
<p><code>–$ cat /proc/sys/fs/file-max</code></p>
<p>输出：<code>97320</code></p>
<p>并发连接总数小于系统可以打开的文件句柄总数，这样就在操作系统可以承受的范围之内</p>
<p>所以，worker_connections 的值需根据 worker_processes 进程数目和系统可以打开的最大文件总数进行适当地进行设置,使得并发总数小于操作系统可以打开的最大文件数目</p>
<p>– # 其实质也就是根据主机的物理CPU和内存进行配置</p>
<p>当然，理论上的并发总数可能会和实际有所偏差，因为主机还有其他的工作进程需要消耗系统资源。</p>
<p><strong>查看系统限制</strong> <code>ulimit -a</code></p>
<h4 id="打开文件句柄数量限制"><a href="#打开文件句柄数量限制" class="headerlink" title="打开文件句柄数量限制"></a>打开文件句柄数量限制</h4><p>是Linux操作系统对一个进程打开的文件句柄数量的限制(也包含打开的SOCKET数量，可影响MySQL的并发连接数目)</p>
<p>系统总限制： <code>/proc/sys/fs/file-max</code> 当前使用句柄数：<code>/proc/sys/fs/file-nr</code></p>
<p>修改句柄数：<code>ulimit -SHn 65535</code></p>
<h3 id="http"><a href="#http" class="headerlink" title="http"></a>http</h3><pre><code>include mime.types; #文件扩展名与文件类型映射表
default_type application/octet-stream; #默认文件类型
charset utf-8; #默认编码
client_header_buffer_size 32k; #上传文件大小限制
</code></pre><h4 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h4><p>sendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</p>
<p>sendfile()还能够用来在两个文件夹之间移动数据</p>
<p><code>tcp_nopush</code> 在linux/Unix系统中优化tcp数据传输，仅在sendfile开启时有效</p>
<p><code>autoindex on;</code>#开启目录列表访问，合适下载服务器，默认关闭。</p>
<p><code>keepalive_timeout 120;</code>#长连接超时时间，单位是秒</p>
<h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><p><code>gzip on;</code> 开启gzip压缩输出</p>
<p><code>gzip_min_length 1k;</code>  设置允许压缩的页面最小字节数，页面字节数从header头得content-length中进行获取。默认值是0，不管页面多大都压缩。建议设置成大于2k的字节数，小于2k可能会越压越大。  </p>
<p><code>gzip_buffers 4 16k;</code> 设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，按照原始数据大小以4k为单位的4倍申请内存。 4 8k 代表以8k为单位，按照原始数据大小以8k为单位的4倍申请内存。    如果没有设置，默认值是申请跟原始数据相同大小的内存空间去存储gzip压缩结果。</p>
<p><code>gzip_http_version 1.0;</code>压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</p>
<p><code>gzip_comp_level 2;</code> 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间  </p>
<p><code>gzip_types text/plain application/x-javascript text/css application/xml;</code></p>
<p>压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</p>
<p>默认值: gzip_types text/html (默认不对js/css文件进行压缩) </p>
<p>压缩类型，匹配MIME类型进行压缩 </p>
<p>设置哪压缩种文本文件可参考 conf/mime.types</p>
<p><code>gzip_disable &quot;MSIE [1-6]\.&quot;;</code>E6及以下禁止压缩</p>
<p><code>gzip_vary on;</code>给CDN和代理服务器使用，针对相同url，可以根据头信息返回压缩和非压缩副本  </p>
<h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><p><code>listen 80;</code>  监听端口</p>
<p><code>server_name www.mashibing.com mashibing.com;</code> 域名可以有多个，用空格隔开</p>
<p><code>charset koi8-r;</code> 编码集</p>
<pre><code class="日志相关">access_log &quot;pipe:rollback logs/host.access_log interval=1d baknum=7 maxsize=2G&quot; main;
</code></pre>
<p><code>index index.html index.htm index.jsp;</code> 默认页<br><code>root /data/www/ha97;</code> 主目录</p>
<h4 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h4><p>虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供www服务，这样就可以实现一台主机对外提供多个web服务，每个虚拟主机之间是独立的，互不影响的</p>
<p><img src="https://www.yremp.live/images/2019/08/25/15629270319297c582.png" alt="15629270319297c582.png"></p>
<p>通过nginx可以实现虚拟主机的配置，nginx支持三种类型的虚拟主机配置</p>
<ul>
<li>基于ip的虚拟主机， （一块主机绑定多个ip地址）</li>
<li>基于域名的虚拟主机（servername）</li>
<li>基于端口的虚拟主机（listen如果不写ip端口模式）</li>
</ul>
<pre><code>http{
    server{
        #表示一个虚拟主机
    }
}
</code></pre><h5 id="location"><a href="#location" class="headerlink" title="location"></a>location</h5><p>映射/虚拟目录</p>
<pre><code>location = / {
    [ configuration A ]
}

location / {
    [ configuration B ]
}

location /documents/ {
    [ configuration C ]
}

location ^~ /images/ {
    [ configuration D ]
}

location ~* \.(gif|jpg|jpeg)$ {
    [ configuration E ]
}
</code></pre><p><code>location [ = | ~ | ~* | ^~ ] uri { ... }</code></p>
<p><code>location URI {}</code> 对当前路径及子路径下的所有对象都生效；</p>
<p><code>location = URI {}</code> 注意URL最好为具体路径。  精确匹配指定的路径，不包括子路径，因此，只对当前资源生效；</p>
<p><code>location ~ URI {}   location ~* URI {}</code>  模式匹配URI，此处的URI可使用正则表达式，~区分字符大小写，~*不区分字符大小写；</p>
<p><code>location ^~ URI {}</code> 禁用正则表达式</p>
<p><strong>优先级</strong>：= &gt; ^~ &gt; ~|~* &gt;  /|/dir/</p>
<h6 id="location配置规则"><a href="#location配置规则" class="headerlink" title="location配置规则"></a>location配置规则</h6><p>location 的执行逻辑跟 location 的编辑顺序无关。<br>矫正：这句话不全对，“普通 location ”的匹配规则是“最大前缀”，因此“普通 location ”的确与 location 编辑顺序无关；</p>
<p>但是“正则 location ”的匹配规则是“顺序匹配，且只要匹配到第一个就停止后面的匹配”；</p>
<p>“普通location ”与“正则 location ”之间的匹配顺序是？先匹配普通 location ，再“考虑”匹配正则 location 。</p>
<p>注意这里的“考虑”是“可能”的意思，也就是说匹配完“普通 location ”后，有的时候需要继续匹配“正则 location ”，有的时候则不需要继续匹配“正则 location ”。两种情况下，不需要继续匹配正则 location ：</p>
<ul>
<li>（ 1 ）当普通 location 前面指定了“ ^~ ”，特别告诉 Nginx 本条普通 location 一旦匹配上，则不需要继续正则匹配；</li>
<li>（ 2 ）当普通location 恰好严格匹配上，不是最大前缀匹配，则不再继续匹配正则</li>
</ul>
<h3 id="IP访问控制"><a href="#IP访问控制" class="headerlink" title="IP访问控制"></a>IP访问控制</h3><pre><code>location  {
    deny  IP /IP段
    deny  192.168.1.109;
    allow 192.168.1.0/24;192.168.0.0/16;192.0.0.0/8
}
</code></pre><h3 id="用户认证访问"><a href="#用户认证访问" class="headerlink" title="用户认证访问"></a>用户认证访问</h3><p>模块ngx_http_auth_basic_module 允许使用“HTTP基本认证”协议验证用户名和密码来限制对资源的访问。</p>
<pre><code>location ~ (.*)\.avi$ {
    auth_basic  &quot;closed site&quot;;
    auth_basic_user_file conf/users;
}
</code></pre><h3 id="httpd-tools"><a href="#httpd-tools" class="headerlink" title="httpd-tools"></a><strong>httpd-tools</strong></h3><pre><code>yum install httpd
htpasswd -c -d /usr/local/users zhangyang
</code></pre><h3 id="nginx访问状态监控"><a href="#nginx访问状态监控" class="headerlink" title="nginx访问状态监控"></a>nginx访问状态监控</h3><pre><code>location /basic_status {
    stub_status on;
}
</code></pre><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>通常的代理服务器，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中由代理服务器向Internet上的web服务器发起请求，最终达到客户机上网的目的。</p>
<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器</p>
<p><img src="https://www.yremp.live/images/2019/08/25/1562928994400344cf.png" alt="1562928994400344cf.png"></p>
<h4 id="经典的反向代理结构"><a href="#经典的反向代理结构" class="headerlink" title="经典的反向代理结构"></a>经典的反向代理结构</h4><p><img src="https://www.yremp.live/images/2019/08/25/1562929023224073f9.png" alt="1562929023224073f9.png"></p>
<pre><code>Proxy_pass http://192.168.43.152/
</code></pre><p>301重定向问题</p>
<h4 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h4><p>反向代理配合upstream使用</p>
<pre><code>upstream httpds {
    server 192.168.43.152:80;
    server 192.168.43.153:80;
}
</code></pre><h5 id="weight-权重"><a href="#weight-权重" class="headerlink" title="weight(权重)"></a><strong>weight(权重)</strong></h5><p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<pre><code>upstream httpds {
    server 127.0.0.1:8050       weight=10 down;
    server 127.0.0.1:8060       weight=1;
    server 127.0.0.1:8060      weight=1 backup;
}
</code></pre><ul>
<li>down：表示当前的server暂时不参与负载 </li>
<li>weight：默认为1.weight越大，负载的权重就越大。 </li>
<li>backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。</li>
</ul>
<h5 id="max-conns"><a href="#max-conns" class="headerlink" title="max_conns"></a><strong>max_conns</strong></h5><p>可以根据服务的好坏来设置最大连接数，防止挂掉，比如1000，我们可以设置800</p>
<pre><code>upstream httpds {
    server 127.0.0.1:8050    weight=5  max_conns=800;
    server 127.0.0.1:8060    weight=1;
}
</code></pre><h5 id="max-fails、-fail-timeout"><a href="#max-fails、-fail-timeout" class="headerlink" title="max_fails、 fail_timeout"></a><strong>max_fails、 fail_timeout</strong></h5><p>max_fails:失败多少次 认为主机已挂掉则，踢出，公司资源少的话一般设置2~3次，多的话设置1次</p>
<p>max_fails=3 fail_timeout=30s代表在30秒内请求某一应用失败3次，认为该应用宕机，后等待30秒，这期间内不会再把新请求发送到宕机应用，而是直接发到正常的那一台，时间到后再有请求进来继续尝试连接宕机应用且仅尝试1次，如果还是失败，则继续等待30秒…以此循环，直到恢复。</p>
<pre><code>upstream httpds {
    server 127.0.0.1:8050    weight=1  max_fails=1  fail_timeout=20;
    server 127.0.0.1:8060    weight=1;
}
</code></pre><h5 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h5><p><strong>轮询+weight</strong>  <strong>ip_hash</strong> <strong>url_hash</strong> <strong>least_conn</strong> <strong>least_time</strong> </p>
<h4 id="健康检查模块"><a href="#健康检查模块" class="headerlink" title="健康检查模块"></a>健康检查模块</h4><p>配置一个status的location</p>
<pre><code>location /status {
    check_status;
}
</code></pre><p>在upstream配置如下</p>
<pre><code>check interval=3000 rise=2 fall=5 timeout=1000 type=http;
check_http_send &quot;HEAD / HTTP/1.0\r\n\r\n&quot;;
check_http_expect_alive http_2xx http_3xx;
</code></pre><h3 id="session共享"><a href="#session共享" class="headerlink" title="session共享"></a>session共享</h3><h4 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h4><h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><ul>
<li>安装libevent</li>
<li>安装memcached</li>
</ul>
<p>可以用yum方式安装 <code>yum –y install memcached</code></p>
<h5 id="启动memcached"><a href="#启动memcached" class="headerlink" title="启动memcached"></a>启动memcached</h5><pre><code>memcached -d -m 128 -u root -l 192.168.43.151 -p 11211 -c 256 -P /tmp/memcached.pid
memcached-tool 192.168.2.51:11211
参数解释：
    -d:后台启动服务
    -m:缓存大小
    -p：端口
    -l:IP
    -P:服务器启动后的系统进程ID，存储的文件
    -u:服务器启动是以哪个用户名作为管理用户
</code></pre><h4 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h4><pre><code>upstream tomcat{
    server 192.168.2.52:8080;
    server 192.168.2.53:8080;
}

location /tomcat {
    proxy_pass http://tomcat/;
} 
</code></pre><h4 id="Tomcat配置"><a href="#Tomcat配置" class="headerlink" title="Tomcat配置"></a>Tomcat配置</h4><p>到tomcat的lib下，jar包见附件</p>
<p>每个tomcat里面的context.xml中加入</p>
<pre><code>&lt;Manager className=&quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&quot; 
    memcachedNodes=&quot;n1:192.168.43.151:11211&quot; 
    sticky=&quot;false&quot; 
    lockingMode=&quot;auto&quot;
    sessionBackupAsync=&quot;false&quot;
    requestUriIgnorePattern=&quot;.*\.(ico|png|gif|jpg|css|js)$&quot;
    sessionBackupTimeout=&quot;1000&quot; transcoderFactoryClass=&quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&quot; 
/&gt;
</code></pre><h3 id="http-proxy-本地磁盘缓存"><a href="#http-proxy-本地磁盘缓存" class="headerlink" title="http_proxy 本地磁盘缓存"></a>http_proxy 本地磁盘缓存</h3><pre><code>proxy_cache_path /path/to/cache levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off;
server {
    set $upstream http://ip:port
    location / {
        proxy_cache my_cache;
        proxy_pass $upstream;
    }
}

/path/to/cache  #本地路径，用来设置Nginx缓存资源的存放地址
levels          #默认所有缓存文件都放在同一个/path/to/cache下，但是会影响缓存的性能，因此通常会在/path/to/cache下面建立子目录用来分别存放不同的文件。假设levels=1:2，Nginx为将要缓存的资源生成的key为f4cd0fbc769e94925ec5540b6a4136d0，那么key的最后一位0，以及倒数第2-3位6d作为两级的子目录，也就是该资源最终会被缓存到/path/to/cache/0/6d目录中
key_zone        #在共享内存中设置一块存储区域来存放缓存的key和metadata（类似使用次数），这样nginx可以快速判断一个request是否命中或者未命中缓存，1m可以存储8000个key，10m可以存储80000个key
max_size        #最大cache空间，如果不指定，会使用掉所有disk space，当达到配额后，会删除最少使用的cache文件
inactive        #未被访问文件在缓存中保留时间，本配置中如果60分钟未被访问则不论状态是否为expired，缓存控制程序会删掉文件。inactive默认是10分钟。需要注意的是，inactive和expired配置项的含义是不同的，expired只是缓存过期，但不会被删除，inactive是删除指定时间内未被访问的缓存文件
use_temp_path   #如果为off，则nginx会将缓存文件直接写入指定的cache文件中，而不是使用temp_path存储，official建议为off，避免文件在不同文件系统中不必要的拷贝
proxy_cache     #启用proxy cache，并指定key_zone。另外，如果proxy_cache off表示关闭掉缓存。
</code></pre>
        </div>
        <!-- .entry-content -->
        </article></main></div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="javascript:;" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2019/08/25/Tengine补充/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Secondes/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://www.yremp.live/images/2019/08/25/QQ201908251819465c68f.gif" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                Tengine补充</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2019/08/25/Lua教程/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Secondes/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://www.yremp.live/images/2019/08/25/QQ20190825181714d2567.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                Lua教程</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "QXrHWOweL6iiH8ULUmPjBVhb-gzGzoHsz",
        appKey: "3es5KSduLLezurh1rn90e0vu",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      
    <!-- #main -->
  </div><!-- #primary -->




    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        //CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 微笑<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/secondes/cdn/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2019</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;"> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i>
		Thanks for theme Sakura by Mashiro&Hojun,Powered by Hexo,Hosted by Coding Pages
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine@1.3.4/dist/Valine.min.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class>
  <div class="m-avatar">
    <img src="https://q2.qlogo.cn/headimg_dl?dst_uin=46029882&spec=640">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">微笑の个人主页</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/Secondes" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="mqqwpa://im/chat?chat_type=wpa&uin=46029882&version=1&src_type=web&web_src=oicqzone.com" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/生活/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/资源/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  资源
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<div class="aplayer" data-id="2380067436" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-loop="all" data-order="random" data-preload="auto" data-volume="0.7" data-mutex="true" < div>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script></div>
  <script src="/js/snow.js"></script>
  <script type="text/javascript" src="/assets/autoload.js"></script>

  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
    <div class="theme-controls row-container">
        <ul class="menu-list">
            <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
            <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
            <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
            <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
            <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
            <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
            <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
            <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
        </ul>
    </div>
	<canvas id="night-mode-cover"></canvas>
</div> 
  <-- <div class="changeSkin-gear no-select">
    <div class="keys" id="setbtn"> 
		<span id="open-skinMenu">切换主题<i class="iconfont icon-gear inline-block rotating"></i> 
		</span>
	</div>
</div> -->
  <div class="changeSkin-gear no-select">
    <div class="keys" id="setbtn"> 
		<span id="open-skinMenu">切换主题<i class="iconfont icon-gear inline-block rotating"></i> 
		</span>
	</div>
</div>
</body>
</html>